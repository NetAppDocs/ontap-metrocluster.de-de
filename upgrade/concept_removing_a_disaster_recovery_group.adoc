---
permalink: upgrade/concept_removing_a_disaster_recovery_group.html 
sidebar: sidebar 
keywords:  
summary: Ab ONTAP 9.8 können Sie eine DR-Gruppe aus einer MetroCluster Konfiguration mit acht Nodes entfernen, um eine MetroCluster Konfiguration mit vier Nodes zu erstellen. 
---
= Entfernen einer DR-Gruppe aus einer MetroCluster -Konfiguration
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Ab ONTAP 9.8 können Sie eine Disaster Recovery (DR)-Gruppe aus einer MetroCluster Konfiguration mit acht Knoten entfernen, um eine MetroCluster Konfiguration mit vier Knoten zu erstellen.


NOTE: Sie verwenden diese Schritte während der Übergangs- und Systemaktualisierungs-Workflows.



== Aktivieren Sie die Konsolenprotokollierung

NetApp empfiehlt dringend, die Konsolenprotokollierung auf den von Ihnen verwendeten Geräten zu aktivieren und folgende Aktionen durchzuführen:

* Lassen Sie AutoSupport während der Wartung aktiviert.
* Lösen Sie vor und nach der Wartung eine Wartungs-AutoSupport-Meldung aus, um die Case-Erstellung für die Dauer der Wartungsaktivität zu deaktivieren.
+
Siehe Knowledge Base-Artikel link:https://kb.netapp.com/Support_Bulletins/Customer_Bulletins/SU92["Wie kann die automatische Case-Erstellung während geplanter Wartungszeiträume unterdrückt werden"^].

* Aktivieren Sie die Sitzungsprotokollierung für jede CLI-Sitzung. Anweisungen zum Aktivieren der Sitzungsprotokollierung finden Sie im Abschnitt „Protokollierung der Sitzungsausgabe“ im Knowledge Base-Artikel link:https://kb.netapp.com/on-prem/ontap/Ontap_OS/OS-KBs/How_to_configure_PuTTY_for_optimal_connectivity_to_ONTAP_systems["So konfigurieren Sie PuTTY für optimale Konnektivität zu ONTAP-Systemen"^].




== Entfernen Sie die DR-Gruppenknoten aus jedem Cluster

Dieses Verfahren wird ab ONTAP 9.8 unterstützt.  Informationen zu Systemen mit ONTAP 9.7 oder früher finden Sie im Knowledge Base-Artikel:link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/MetroCluster/How_to_remove_a_DR-Group_from_a_MetroCluster["So entfernen Sie eine DR-Gruppe aus einer MetroCluster-Konfiguration"^] .

.Über diese Aufgabe
Eine Konfiguration mit acht Nodes umfasst acht Nodes, die als zwei DR-Gruppen mit vier Nodes organisiert sind.

image::../media/mcc_dr_groups_8_node.gif[mcc dr Gruppen 8 Knoten]

Wenn Sie eine DR-Gruppe entfernen, verbleiben vier Knoten in der Konfiguration.

image::../media/mcc_dr_groups_4_node.gif[mcc dr Gruppen 4 Knoten]

.Bevor Sie beginnen
* Sie müssen diesen Schritt auf beiden Clustern durchführen.
* Der `metrocluster remove-dr-group` Befehl wird nur auf ONTAP 9.8 und höher unterstützt.


.Schritte
. Bereiten Sie das Entfernen der DR-Gruppe vor, falls Sie dies noch nicht getan haben.
+
.. Verschieben Sie alle Daten-Volumes in eine andere DR-Gruppe.
.. Wenn die zu entfernende DR-Gruppe über Load-Sharing-Spiegelvolumes verfügt, erstellen Sie alle Load-Sharing-Spiegelvolumes in einer anderen DR-Gruppe neu und löschen Sie sie aus der zu entfernenden DR-Gruppe.
.. Verschieben Sie alle MDV_CRS-Metadaten-Volumes in eine andere DR-Gruppe, indem Sie die befolgen link:https://docs.netapp.com/us-en/ontap-metrocluster/upgrade/task_move_a_metadata_volume_in_mcc_configurations.html["Verschieben eines Metadaten-Volumes in MetroCluster Konfigurationen"] Verfahren.
.. Löschen Sie alle MDV_aud-Metadaten-Volumes, die in der zu entfernenden DR-Gruppe vorhanden sein könnten.
.. Löschen Sie alle Datenaggregate in der zu entfernenden DR-Gruppe:
+
[listing]
----
ClusterA::> storage aggregate show -node ClusterA-01, ClusterA-02 -fields aggregate ,node
ClusterA::> aggr delete -aggregate aggregate_name
ClusterB::> storage aggregate show -node ClusterB-01, ClusterB-02 -fields aggregate ,node
ClusterB::> aggr delete -aggregate aggregate_name
----
+

NOTE: Root-Aggregate werden nicht gelöscht.

.. Migrieren Sie alle NAS-Daten-LIFs, die Sie für NFS und CIFS (SMB) verwenden, auf Home-Knoten in einer anderen DR-Gruppe. + 
`network interface show -home-node <old_node>`
+
`network interface migrate -vserver <svm_name> -lif <data_lif> -destination-node <new_node> -destination-port <port>`

.. Verschieben Sie die Daten-LIFs auf den neuen Home-Knoten in einer anderen DR-Gruppe.
`network interface modify -vserver <svm-name> -lif <data-lif> -home-node <new_node> -home-port <port>`
.. Migrieren Sie die Cluster-Management-LIF auf einen Home-Node in einer anderen DR-Gruppe.
+
`network interface show -role cluster-mgmt`

+
`network interface modify -vserver <svm-name> -lif <cluster_mgmt> -home-node <new_node> -home-port <port-id>`

+
[NOTE]
====
*** Knotenverwaltung und LIFs zwischen Clustern werden nicht migriert.  Erstellen Sie nach Bedarf neue Knotenverwaltungs- und Cluster-übergreifende LIFs auf Knoten der DR-Gruppe.
*** Sie können FCP-Schnittstellen, die für den Blockzugriff (SAN) verwendet werden, nicht zwischen den Knoten migrieren oder verschieben.  Erstellen Sie nach Bedarf neue FCP-Schnittstellen.
*** iSCSI SAN LIFs müssen ausgefallen sein, bevor der Home-Knoten und der Home-Port aktualisiert werden können.


====
.. Übertragen Sie Epsilon auf einen Node in einer anderen DR-Gruppe, falls erforderlich.
+
[listing]
----
ClusterA::> set advanced
ClusterA::*> cluster show
Move epsilon if needed
ClusterA::*> cluster modify -node nodename -epsilon false
ClusterA::*> cluster modify -node nodename -epsilon true

ClusterB::> set advanced
ClusterB::*> cluster show
ClusterB::*> cluster modify -node nodename -epsilon false
ClusterB::*> cluster modify -node nodename -epsilon true
ClusterB::*> set admin
----


. Identifizieren und entfernen Sie die DR-Gruppe.
+
.. Identifizieren Sie die richtige DR-Gruppe für das Entfernen:
+
`metrocluster node show`

.. Entfernen Sie die Knoten der DR-Gruppe: +
`metrocluster remove-dr-group -dr-group-id 1`
+
Im folgenden Beispiel wird das Entfernen der Konfiguration der DR-Gruppe auf „Cluster_A“ gezeigt

+
.Beispiel
[%collapsible]
====
[listing]
----
cluster_A::*>

Warning: Nodes in the DR group that are removed from the MetroCluster
         configuration will lose their disaster recovery protection.

         Local nodes "node_A_1-FC, node_A_2-FC"will be removed from the
         MetroCluster configuration. You must repeat the operation on the
         partner cluster "cluster_B"to remove the remote nodes in the DR group.
Do you want to continue? {y|n}: y

Info: The following preparation steps must be completed on the local and partner
      clusters before removing a DR group.

      1. Move all data volumes to another DR group.
      2. Move all MDV_CRS metadata volumes to another DR group.
      3. Delete all MDV_aud metadata volumes that may exist in the DR group to
      be removed.
      4. Delete all data aggregates in the DR group to be removed. Root
      aggregates are not deleted.
      5. Migrate all data LIFs to home nodes in another DR group.
      6. Migrate the cluster management LIF to a home node in another DR group.
      Node management and inter-cluster LIFs are not migrated.
      7. Transfer epsilon to a node in another DR group.

      The command is vetoed if the preparation steps are not completed on the
      local and partner clusters.
Do you want to continue? {y|n}: y
[Job 513] Job succeeded: Remove DR Group is successful.

cluster_A::*>
----
====


. Wiederholen Sie den vorherigen Schritt im Partner-Cluster.
. Deaktivieren Sie das Speicherfailover auf den Knoten der alten DR-Gruppe:
+
`storage failover modify -node <node-name> -enable false`

. Wenn Sie sich in einer MetroCluster -IP-Konfiguration befinden, führen Sie die folgenden Schritte aus, um die Remote-Plexes der Root-Aggregate zu löschen und den Festplattenbesitz auf den Knoten der alten DR-Gruppe zu entfernen.
+
Diese Schritte müssen für beide Knoten im HA-Paar an jedem Standort ausgeführt werden.

+
.. Zeigen Sie die Remote-Plexes der Root-Aggregate auf den Knoten in der DR-Gruppe an, die gelöscht werden soll:
+
`storage aggregate plex show -aggregate <root_aggr_name> -pool 1`

.. Löschen Sie die Remote-Plexes:
+
`storage aggregate plex delete -aggregate <root_aggr_name> -plex <plex_from_previous_step>`

.. Identifizieren Sie die Remote-Datenträger, die den Knoten in der DR-Gruppe gehören.
+
Die zu verwendenden Befehle hängen davon ab, ob Sie partitionierte/gemeinsam genutzte Festplatten oder ganze Festplatten verwenden:

+

NOTE: Verwenden Sie eine durch Kommas getrennte Liste in der `-owner <node_names>` , um die Knotennamen in der DR-Gruppe anzugeben, die gelöscht werden soll.

+
[role="tabbed-block"]
====
.Partitionierte/gemeinsam genutzte Datenträger:
--
... Legen Sie die Berechtigungsebene auf erweitert fest:
+
`set advanced`

... Zeigen Sie die Remote-Festplatten an:
+
`storage disk show -pool Pool1 -owner <node_names> -partition-ownership`



--
.Ganze Festplatten:
--
... Legen Sie die Berechtigungsebene auf erweitert fest:
+
`set advanced`

... Zeigen Sie die Remote-Festplatten an:
+
`storage disk show -pool Pool1 -owner <node_names>`



--
====
.. Automatische Datenträgerzuweisung deaktivieren:
+
`disk option modify -node <node_names_in_the_DR_group_to_be_deleted>  -autoassign off`

.. Entfernen Sie den Besitz der Pool1-Datenträger auf jedem zu löschenden DR-Gruppenknoten.  Führen Sie diese Schritte auf jedem zu entfernenden Knoten aus.
+
... Gehen Sie zur Node-Shell:
+
`run -node <node_name>`

... Identifizieren Sie die Pool1-Festplatten:
+
`aggr status -s`

+
Es werden alle Ersatzfestplatten angezeigt, einschließlich der Ersatzfestplatten Pool0 und Pool1, die dem Knoten gehören.

... Entfernen Sie den Festplattenbesitz für jede Ersatzfestplatte von Pool1:
+
`disk remove_ownership <disk_name>`

+
Entfernen Sie bei partitionierten Datenträgern den Partitionsbesitz und dann den Containerdatenträgerbesitz.





. Wenn Sie sich in einer MetroCluster -IP-Konfiguration befinden, entfernen Sie die MetroCluster Verbindungen auf den Knoten der alten DR-Gruppe.
+
Diese Befehle können von beiden Clustern ausgegeben werden und gelten für die gesamte DR-Gruppe, die beide Cluster umfasst.

+
.. Trennen Sie die Verbindungen:
+
`metrocluster configuration-settings connection disconnect -dr-group-id <dr_group_id>`

+
.Beispiel
[%collapsible]
====
[listing]
----
cluster_A::*> metrocluster configuration-settings connection disconnect -dr-group-id 1

Warning: For the nodes in the DR group 1, this command will remove the existing connections that are used to mirror NV logs and access remote storage.
Do you want to continue? {y|n}: y

Warning: Before proceeding with disconnect, you must verify the following:
      1. Unmirrored aggregates do not have disks in remote plexes.
      2. Aggregates are not mirrored.
      3. No disks are assigned in Pool1.
      4. Storage failover is not enabled.
      Follow the "MetroCluster Installation and Configuration guide" for detailed instructions to verify this.
Do you want to continue? {y|n}: y
----
====
.. Löschen Sie die MetroCluster-Schnittstellen auf den Knoten der alten DR-Gruppe:
+

NOTE: Dieser Schritt muss auf jedem Knoten der DR-Gruppe wiederholt werden.

+
`metrocluster configuration-settings interface delete`

.. Löschen Sie die Konfiguration der alten DR-Gruppe. +
`metrocluster configuration-settings dr-group delete`


. Heben Sie die Verbindung zu den Knoten in der alten DR-Gruppe auf.
+
Führen Sie diesen Schritt auf jedem Cluster aus.

+
.. Legen Sie die erweiterte Berechtigungsebene fest:
+
`set -privilege advanced`

.. Knoten trennen: +
`cluster unjoin -node <node-name>`
+
Wiederholen Sie diesen Schritt für den anderen lokalen Knoten in der alten DR-Gruppe.

.. Legen Sie die Administratorberechtigungsstufe fest:
+
`set -privilege admin`



. Überprüfen Sie, ob Cluster-HA in der neuen DR-Gruppe aktiviert ist.  Aktivieren Sie Cluster HA bei Bedarf erneut:
+
`cluster ha modify -configured true`

+
Führen Sie diesen Schritt auf jedem Cluster aus.

. Halten Sie den Vorgang an, schalten Sie ihn aus und entfernen Sie die alten Controller-Module und Storage-Shelfs.

